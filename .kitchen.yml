---
driver:
  name: ec2
  region: us-east-1
  availability_zone: us-east-1c
  subnet_id: <%= ENV['AWS_SUBNET_ID']  %>
  associate_public_ip: true
  instance_type: t2.micro
  retryable_tries: 180
  tags:
    Name: "amimoto-die-hard"

transport:
  username: ec2-user
  aws_ssh_key_id: <%= ENV['AWS_SSH_KEY_ID']  %>
  ssh_key: <%= ENV['AWS_SSH_KEY_PATH'] %>

provisioner:
  name: shell

platforms:
  - name: hiphop-amimoto
    driver:
      image_id: ami-23041c49 #1.2.1
  - name: modphp-amimoto
    driver:
      image_id: ami-4eeedb59 # 1.2.0
  - name: pvm-amimoto
    driver:
      image_id: ami-8f3921e5 # 1.5.1
      instance_type: m1.medium
  - name: hvm-amimoto
    driver:
      image_id: ami-d54a7cc2 # 1.4.0
  - name: woo-hhvm-amimoto
    driver:
      image_id: ami-1b031b71 # 1.1.1
  - name: woo-hvm-amimoto
    driver:
      image_id: ami-98051df2 # 1.1.1
  - name: woo-modphp-amimoto
    driver:
      image_id: ami-fe021a94 # 1.1.1
  - name:  hvm-php7-amimoto
    driver:
      image_id: ami-d54a7cc2 #1.4.0

verifier:
  name: shell
  command: bundle exec rspec -fd
#  sleep: 300

suites:
  - name: default
    run_list:
    attributes:
<%
## Periodic outputs for CircleCI
if ENV['CI']
  ppid = Process.pid
  Process.fork {
    loop {
      puts "."
      begin
        Process.getpgid( ppid )
        sleep 20
      rescue
        exit 0
      end
    }
  }
end
%>
